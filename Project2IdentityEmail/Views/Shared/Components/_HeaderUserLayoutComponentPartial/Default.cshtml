@using Microsoft.AspNetCore.Identity
@inject UserManager<AppUser> UserManager

@{
    var currentUser = await UserManager.GetUserAsync(User);
    var messages = ViewBag.Messages as List<Project2IdentityEmail.Entities.Message> ?? new();
    var senderImages = ViewBag.SenderImages as Dictionary<string, string> ?? new();
    var newMessageCount = (int?)ViewBag.UnreadCount ?? 0;




}

<header class="topbar">
    <nav class="navbar top-navbar navbar-expand-md navbar-dark">
        <div class="navbar-header">
            <div class="navbar-brand">
                <a href="/MessageController1/Inbox" class="logo">
                    <b class="logo-icon">
                        <img src="~/mendy-admin/package/assets/images/logo-icon.png" alt="homepage" class="dark-logo" />
                        <img src="~/mendy-admin/package/assets/images/logo-light-icon.png" alt="homepage" class="light-logo" />
                    </b>
                    <span class="logo-text">
                        <img src="~/mendy-admin/package/assets/images/logo-text.png" alt="homepage" class="dark-logo" />
                        <img src="~/mendy-admin/package/assets/images/logo-light-text.png" class="light-logo" alt="homepage" />
                    </span>
                </a>
            </div>
        </div>

        <div class="navbar-collapse collapse" id="navbarSupportedContent">
            <ul class="navbar-nav float-left mr-auto">
                <li class="nav-item dropdown">
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li>
            </ul>

            <ul class="navbar-nav float-right">

                <!-- User profile -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle waves-effect waves-dark pro-pic" href="" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">
                        <span class="mr-3 font-normal d-none d-sm-inline-block pro-name">
                            <span>Merhaba</span>
                            @(currentUser?.Name ?? currentUser?.UserName) @(currentUser?.Surname ?? "")
                        </span>

                        <img src="~/images/@(currentUser?.ImageUrl ?? "default.png")"
                             alt="user"
                             class="rounded-circle"
                             width="40">
                    </a>

                    <div class="dropdown-menu dropdown-menu-right user-dd animated flipInY">
                        <div class="d-flex no-block align-items-center p-3 bg-light mb-2">
                            <div class="">
                                <img src="~/images/@(currentUser?.ImageUrl ?? "default.png")"
                                     alt="user"
                                     class="rounded-circle"
                                     width="60">
                            </div>
                            <div class="ml-2">
                                <h4 class="mb-0">@currentUser?.UserName</h4>
                                <p class="mb-0">@currentUser?.Email</p>
                            </div>
                        </div>

                        <div class="profile-dis scrollable">
                            <a class="dropdown-item" href="/ProfileController1/EditProfile">
                                <i class="ti-user mx-1"></i> Profilim
                            </a>
                         
                            <a class="dropdown-item" href="/MessageController1/Inbox">
                                <i class="ti-email mx-1"></i> Gelen Kutusu
                            </a>
                           
                           
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="javascript:void(0)">
                                <i class="fa fa-power-off mx-1"></i> Çıkış
                            </a>
                        </div>
                    </div>
                </li>

             
            
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle waves-effect waves-dark" href="" id="2" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">
                        <i data-feather="mail"></i>
                        @if (newMessageCount > 0)
                        {
                            <span class="badge badge-pill badge-danger noti">@newMessageCount</span>
                        }
                    </a>

                    <div class="dropdown-menu dropdown-menu-right mailbox animated bounceInDown" aria-labelledby="2">
                        <ul class="list-style-none">
                            <li>
                                <div class="drop-title bg-light">
                                    <h4 class="mb-0 mt-1">@newMessageCount Yeni Mesaj</h4>
                                </div>
                            </li>

                            <li>
                                <div class="message-center message-body">
                                    @foreach (var item in messages)
                                    {
                                        

                                        <a href="/MessageController1/MessageDetail/@item.MessageId" class="message-item">
                                           

                                            <div class="mail-contnet">
                                                <h5 class="message-title">@item.Subject</h5>
                                                <span class="mail-desc">@item.SenderEmail</span>
                                                
                                            </div>
                                        </a>
                                    }
                                </div>

                            </li>

                            <li>
                                <a class="nav-link text-center link text-dark" href="/MessageController1/Inbox">
                                    <b>Tüm Mailleri Gör</b>
                                    <i class="fa fa-angle-right"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>

            </ul>
        </div>
    </nav>
</header>
